$(function(){function j(){var e="0123456789ABCDEF".split(""),t="#";for(var n=0;n<6;n++)t+=e[Math.round(Math.random()*15)];return t}function F(){var e="";for(var t=0;t<ccolor.length;t++)if(!ccolor[t]){e=COLOR[t],ccolor[t]=!0;break}return e==""&&(COLOR.push(j()),e=COLOR[COLOR.length-1],ccolor[t]=!0),e}function I(e){ccolor[COLOR.indexOf(H[e].color)]=!1,o.splice(e,1),H.splice(e,1);var t="";for(var n=0;n<H.length;n++)H[n].html='<div class=shape style="background-color:'+H[n].color+';" id=s_'+n+" >\ny="+H[n].fn,H[n].html+='\n<i class="icon-remove-sign icon-white deleteb" id=delete_'+n+"></i>\n",H[n].html+="</div>\n",t+=H[n].html;H.length<16&&$("#curves").css("overflow-y",""),r.html(t),U(),z()}function R(e){var t=e,n=F();s.strokeStyle=n,dd=new et(t,n);if(dd.ret==0)return ccolor[COLOR.indexOf(n)]=!1,!1;H.push(dd);var i='<div class=shape style="background-color:'+n+';" id=s_'+(H.length-1)+" >\ny="+H[H.length-1].fn;i+='\n<i class="icon-remove-sign icon-white deleteb" id=delete_'+(H.length-1)+"></i>\n",i+="</div>\n",H[H.length-1].html=i,o[H.length-1]=!1,H.length>=16&&$("#curves").css("overflow-y","scroll"),s.strokeStyle="black",f="";for(k=0;k<H.length;k++)f+=H[k].html;r.html(f),$("#circlesize").val(""),U(),z()}function U(){for(w=0;w<H.length;w++)$("#s_"+w).mouseenter({w:w},function(e){o[e.data.w]||(H[e.data.w].lwidth=3,z())}),$("#s_"+w).click({w:w},function(e){o[e.data.w]?(H[e.data.w].lwidth=1,z(),o[e.data.w]=!1):(H[e.data.w].lwidth=3,o[e.data.w]=!0,z())}),$("#s_"+w).mouseleave({w:w},function(e){o[e.data.w]||(H[e.data.w].lwidth=1,z())}),$("#delete_"+w).click({w:w},function(e){I(e.data.w)})}function z(){s.clearRect(0,0,n.width,n.height),B.draw("dec"),B.drawZBar();for(w=0;w<H.length;w++)s.strokeStyle=H[w].color,H[w].draw(),s.strokeStyle="black";W(" "),X(" "),s.clearRect(0,0,s.width,25),s.clearRect(0,s.height-25,s.width,25)}function W(e){s.clearRect(0,0,n.width,25),s.font="10pt Calibri",s.fillStyle="black",s.fillText(e,10,20)}function X(e){s.clearRect(0,n.height-25,n.width,25),s.font="10pt Calibri",s.fillStyle="black",s.fillText(e,10,20)}function V(e){s.clearRect(n.width/2,0,n.width/2,25),s.font="10pt Calibri",s.fillStyle="black",s.fillText(e,n.width/2+10,20)}function J(e,t){return t==0?e:e<t?J(t,e):J(e-t,t)}function K(e,t,n){s.clearRect(t-5,n,t+5,n+10),s.font="12pt Calibri",s.fillStyle="black",s.fillText(e,t-7,n+15)}function Q(e,t,n){s.beginPath(),s.arc(e,t,n,0,2*Math.PI,!1),s.closePath(),s.stroke()}function G(e,t,n,r){s.beginPath(),s.moveTo(e,t),s.lineTo(n,r),s.stroke(),s.closePath()}function Y(e,t){form=new Array;for(i=0;i<e.length;i++)isNaN(e[i])?e[i]=="x"?form.push(t):fns.indexOf(e[i])!=-1?form.push(tt(e[i],form.pop(),0)):form.push(tt(e[i],form.pop(),form.pop())):form.push(e[i]);return form[0]}function Z(e){sy=rt(e);if(sy==0)return!1;var t=new Array,r=new Array,i,o;for(q=p;q<n.width-p;q+=1)xpos=q,curx=P*(xpos-M)/D,cury=Y(sy,curx)/P,ypos=_-D*cury,ypos>=0&&ypos<=n.height+p&&(t.push([curx,cury]),r.push([q,Math.round(ypos)]),q>p&&(Math.abs(st(o[0],o[1],curx,cury))<2*P?G(i[0],i[1],xpos,ypos):s.fillRect(xpos,ypos,1,1))),i=[xpos,ypos],o=[curx,cury];return[t,r]}function et(e,t){this.fn=e,this.html="",this.lwidth=1,this.ret=Z(e);if(this.ret==0)return!1;this.color=t,this.values=this.ret[0],this.pos=this.ret[1],this.draw=function(){return s.lineWidth=this.lwidth,this.ret=Z(this.fn),s.lineWidth=1,this.values=this.ret[0],this.pos=this.ret[1],this.values}}function tt(e,t,n){if(e=="+")return t+n;if(e=="-")return n-t;if(e=="*")return t*n;if(e=="/")return n/t;if(e=="^")return Math.pow(n,t);if(e=="q")return Math.asin(t);if(e=="r")return Math.acos(t);if(e=="k")return Math.atan(t);if(e=="s")return Math.sin(t);if(e=="c")return Math.cos(t);if(e=="t")return Math.tan(t);if(e=="u")return 1/Math.tan(t);if(e=="d")return 1/Math.cos(t);if(e=="o")return 1/Math.sin(t);if(e=="l")return Math.log(t)}function nt(e){return opers[e]!=null?!0:!1}function rt(e){for(i=0;i<e.length;i++)e.charAt(i)==" "&&(e=e.substr(0,i)+e.substr(i,e.length));for(i=0;i<ops.length;i++)while(e.indexOf(ops[i])!=-1)e=e.substr(0,e.indexOf(ops[i]))+sop[ops[i]]+e.substr(e.indexOf(ops[i])+ops[i].length,e.length);tokens=new Array,e[0]=="-"&&(e="0"+e);for(i=0;i<ops.length;i++)e[i]=="-"&&e[i-1]=="("&&(e=e.substr(0,i)+"0"+e.substr(i,e.length));var n=new it,r=new Array;for(i=0;i<e.length;i+=1){var s=e.charAt(i);tokens.push(e.charAt(i));if(e.charAt(i)=="x")(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="p"||tokens[tokens.length-2]=="e"||tokens[tokens.length-2]=="x")&&r.push("*"),n.enqueue("x");else if(e.charAt(i)=="p")n.enqueue(Math.PI),(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="x"||tokens[tokens.length-2]=="e")&&r.push("*");else if(e.charAt(i)=="e"){if(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="x"||tokens[tokens.length-2]=="p")r.push("*"),n.enqueue(Math.E)}else if(!isNaN(s)){var o=+s,u=2;s=e.substr(i,u);while(!isNaN(s)&&u+i<=e.length)o=+s,u+=1,s=e.substr(i,u);i=i+u-2,n.enqueue(o)}else if(fns.indexOf(e.charAt(i))!=-1){if(lbrac.indexOf(e.charAt(i+1))==-1)return alert("Error: There has to be a bracket after trignometric, log functions"),!1;r.push(e.charAt(i))}else if(nt(e.charAt(i))){while(r.length!=0&&nt(r[r.length-1])){if(["+","-","*","/"].indexOf(e.charAt(i))!=-1){if(!(opers[e.charAt(i)]>=opers[r[r.length-1]]))break;n.enqueue(r.pop())}if(e.charAt(i)=="^"){if(!(opers[e.charAt(i)]>opers[r[r.length-1]]))break;n.enqueue(r.pop())}}r.push(e.charAt(i))}else if(lbrac.indexOf(e.charAt(i))!=-1)(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="x"||tokens[tokens.length-2]=="p"||tokens[tokens.length-2]=="e"||rbrac.indexOf(tokens[tokens.length-2])!=-1)&&r.push("*"),r.push(e.charAt(i));else{if(rbrac.indexOf(e.charAt(i))==-1)return alert("Error: symbol not recognized"),!1;while(r[r.length-1]!=lbrac[rbrac.indexOf(e.charAt(i))]){if(r.length==0)return alert("Error: mismatched parentheses"),!1;n.enqueue(r.pop())}r.pop(),fns.indexOf(r[r.length-1])!=-1&&n.enqueue(r.pop())}}while(r.length!=0){if(r[r.length-1]=="(")return alert("Error: mismatched parentheses"),!1;t=r.pop(),n.enqueue(t)}var a=n.arr();return a}function it(){this.ar=new Array,this.start=0,this.end=this.ar.length,this.enqueue=function(e){this.ar[this.end]=e,this.end+=1},this.dequeue=function(){return this.start+=1,this.ar[this.start-1]},this.peek=function(){return this.ar[this.start]},this.arr=function(){var e=new Array;for(i=this.start;i<this.end;i++)e[i-this.start]=this.ar[i];return e},this.toString=function(){var e="";for(i=this.start;i<this.end;i+=1)e+=this.ar[i]+", ";return e},this.empty=function(){return this.end-this.start==0?!0:!1}}function st(e,t,n,r){return xdiff=e-n,ydiff=t-r,Math.sqrt(xdiff*xdiff+ydiff*ydiff)}COLOR=["#049cdb","#46a546","#9d261d","#f89406","#c3325f","#7a43b6","#ffc40d"],ccolor=new Array;for(var e=0;e<COLOR.length;e++)ccolor[e]=!1;var n=$("#canvas")[0],r=$("#curves"),s=n.getContext("2d"),o=new Array,u,a,l,c,h=!1,p=25,d,v=180,g=null,y=null,b=null,E=null,S=null,x=null,T=null,N=null,C=null,L=null,A=null,O=null,M=n.width/2,_=n.height/2,D=0,P=1,H=new Array,B={num:10,centerx:n.width/2,centery:n.height/2,snum:10,mid:0,diff:1,zbarc:v,initz:v,zoomin:[1,.5,.25,.2,.1,.05],zoomout:[1,2,5,10,50,100],zoominf:[1,2,4,5,10,20],iewid:Math.floor((n.width-2*p)/100),ewid:Math.floor((n.width-2*p)/100),lower:40,upper:320,ldiv:20,fdiff:1,movemid:function(){var e=u-l,t=a-c;l=u,c=a,this.centerx+=e,this.centery+=t},zoom:function(e){this.ewid=(this.iewid-2.5)*(e/this.ldiv)+2.5,D=this.ewid*this.snum},moveZBar:function(){var e=a-c;c=a,e+this.zbarc<=this.upper-this.ldiv-1&&e+this.zbarc>=this.lower+this.ldiv+1&&(this.zbarc+=e,v=this.zbarc,this.zbarc>this.initz?(this.diff=this.zoomout[Math.floor((this.zbarc-this.initz)/this.ldiv)],P=this.diff,this.zoom(this.ldiv-(this.zbarc-this.initz)+Math.floor((this.zbarc-this.initz)/this.ldiv)*this.ldiv)):(this.diff=this.zoomin[Math.floor((this.initz-this.zbarc)/this.ldiv)],P=this.diff,this.fdiff=this.zoominf[Math.floor((this.initz-this.zbarc)/this.ldiv)],this.zoom(this.initz-this.zbarc-Math.floor((this.initz-this.zbarc)/this.ldiv)*this.ldiv)))},curpos:function(){m=this.ewid*this.snum,W("x="+Math.round(this.diff*(u-this.centerx)/m*100)/100+", y="+Math.round(this.diff*(this.centery-a)/m*100)/100)},drawZBar:function(){s.strokeStyle="black",pzba=new Image,pzba.onload=function(){s.drawImage(pzba,3,B.lower-14)},pzba.src="assets/plus.png",mzba=new Image,mzba.onload=function(){s.drawImage(mzba,3,B.upper)},mzba.src="assets/minus.png",G(5,this.zbarc-this.ldiv,5,this.zbarc+this.ldiv),G(5,this.zbarc+this.ldiv,15,this.zbarc+this.ldiv),G(15,this.zbarc+this.ldiv,15,this.zbarc-this.ldiv),G(15,this.zbarc-this.ldiv,5,this.zbarc-this.ldiv)},draw:function(e){s.strokeStyle="e3e3e3";var r=n.width-p,o=p;t=this.mid;var u=this.mid,a=0;for(i=this.centerx;i>=p;i-=this.ewid*this.snum){if(i<=n.width-p){a==0&&(y=t),a+=1,G(i,p,i,n.height-p);if(i!=this.centerx)if(e=="dec"||this.diff>=1)s.font="9pt Calibri",s.fillStyle="black",(Math.round(t*1e3)/1e3).toString().length<2?s.fillText(Math.round(t*1e3)/1e3,i-5,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<3?s.fillText(Math.round(t*1e3)/1e3,i-10,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<4?s.fillText(Math.round(t*1e3)/1e3,i-15,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<5?s.fillText(Math.round(t*1e3)/1e3,i-20,this.centery+10):s.fillText(Math.round(t*1e3)/1e3,i-25,this.centery+10);else{var f=-u,l=this.fdiff,c=J(f,l);f=Math.round(f/c),l=Math.round(l/c),s.font="9pt Calibri",s.fillStyle="black",l!=1?(s.fillText(-f,i-9,this.centery+5),s.fillText("__",i-9,this.centery+5),s.fillText(l,i-9,this.centery+10)):s.fillText(-f,i-9,this.centery+5)}}g=t,t-=this.diff,u-=1}s.fillText(0,this.centerx-5,this.centery+10),u=this.mid,t=this.mid,a=0;for(i=this.centerx;i<=n.width-p;i+=this.ewid*this.snum){if(i>=p){a==0&&(b=t),a+=1,G(i,p,i,n.height-p);if(i!=this.centerx)if(e=="dec"||this.diff>=1)s.font="9pt Calibri",s.fillStyle="black",(Math.round(t*1e3)/1e3).toString().length<2?s.fillText(Math.round(t*1e3)/1e3,i-5,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<3?s.fillText(Math.round(t*1e3)/1e3,i-10,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<4?s.fillText(Math.round(t*1e3)/1e3,i-15,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<5?s.fillText(Math.round(t*1e3)/1e3,i-20,this.centery+10):s.fillText(Math.round(t*1e3)/1e3,i-25,this.centery+10);else{var f=u,l=this.fdiff,c=J(f,l);f=Math.round(f/c),l=Math.round(l/c),s.font="9pt Calibri",s.fillStyle="black",l!=1?(s.fillText(f,i-9,this.centery+5),s.fillText("__",i-9,this.centery+5),s.fillText(l,i-9,this.centery+5)):s.fillText(-f,i-9,this.centery+5)}}E=t,t+=this.diff,u+=1}t=this.mid;var u=0;a=0;for(i=this.centery;i>=p;i-=this.ewid*this.snum){if(i<=n.width-p){a==0&&(T=t),a+=1,G(p,i,n.width-p,i);if(i!=this.centery)if(e=="dec"||this.diff>=1)s.font="9pt Calibri",s.fillStyle="black",(Math.round(t*1e3)/1e3).toString().length<2?s.fillText(Math.round(t*1e3)/1e3,this.centerx-5,i+10):(Math.round(t*1e3)/1e3).toString().length<3?s.fillText(Math.round(t*1e3)/1e3,this.centerx-10,i+10):(Math.round(t*1e3)/1e3).toString().length<4?s.fillText(Math.round(t*1e3)/1e3,this.centerx-15,i+10):(Math.round(t*1e3)/1e3).toString().length<5?s.fillText(Math.round(t*1e3)/1e3,this.centerx-20,i+10):s.fillText(Math.round(t*1e3)/1e3,this.centerx-25,i+10);else{var f=-u,l=this.fdiff,c=J(f,l);f=Math.round(f/c),l=Math.round(l/c),s.font="9pt Calibri",s.fillStyle="black",l!=1?(s.fillText(-f,this.centerx-10,i-3),s.fillText("__",this.centerx-10,i-3),s.fillText(l,this.centerx-10,i+2)):s.fillText(-f,this.centerx-10,i)}}N=t,t+=this.diff,u+=1}u=0,t=this.mid,a=0;for(i=this.centery;i<=n.width-p;i+=this.ewid*this.snum){if(i>=p){a==0&&(x=t),a+=1,G(p,i,n.width-p,i);if(i!=this.centerx)if(e=="dec"||this.diff>=1)s.font="9pt Calibri",s.fillStyle="black",(Math.round(t*1e3)/1e3).toString().length<2?s.fillText(Math.round(t*1e3)/1e3,this.centerx-5,i+10):(Math.round(t*1e3)/1e3).toString().length<3?s.fillText(Math.round(t*1e3)/1e3,this.centerx-10,i+10):(Math.round(t*1e3)/1e3).toString().length<4?s.fillText(Math.round(t*1e3)/1e3,this.centerx-15,i+10):(Math.round(t*1e3)/1e3).toString().length<5?s.fillText(Math.round(t*1e3)/1e3,this.centerx-20,i+10):s.fillText(Math.round(t*1e3)/1e3,this.centerx-25,i+10);else{var f=u,l=this.fdiff,c=J(f,l);f=Math.round(f/c),l=Math.round(l/c),s.font="9pt Calibri",s.fillStyle="black",l!=1?(s.fillText(f,this.centerx-10,i-3),s.fillText("__",this.centerx-10,i-3),s.fillText(l,this.centerx-10,i+2)):s.fillText(-f,this.centerx-10,i)}}S=t,t-=this.diff,u-=1}g!=null?A=g:A=b,E!=null?C=E:C=y,S!=null?O=S:O=T,N!=null?L=N:L=x,M=this.centerx,_=this.centery,D=this.ewid*this.snum}};B.draw("dec"),B.drawZBar(),$("#canvas").mousedown(function(e){l=u,c=a,h=!0}),$("#undo").click(function(){ccolor[COLOR.indexOf(H[H.length-1].color)]=!1,H.pop(),z();var e="";for(k=0;k<H.length;k++)e+=H[k].html;r.html(e)}),$("#circlesize").keypress(function(e){e.keyCode==13&&(R($("#circlesize").attr("value")),W(" "),X(" "),s.clearRect(0,0,s.width,25),s.clearRect(0,s.height-25,s.width,25))}),$("#function").click(function(){R($("#circlesize").attr("value")),W(" "),X(" "),s.clearRect(0,0,s.width,25),s.clearRect(0,s.height-25,s.width,25)}),$("#canvas").mouseup(function(e){h=!1}),$("#canvas").scroll(function(e){}),$("#canvas").mousemove(function(e){var t=$("#canvas").offset(),r=Math.round(t.left),i=Math.round(t.top);u=e.pageX-r,a=e.pageY-i;if(h){l>p&&(B.movemid(),s.clearRect(0,0,n.width,n.height),B.draw("dec"),B.drawZBar()),l>5&&l<20&&c>v-25&&c<v+25&&(B.moveZBar(),s.clearRect(0,0,n.width,n.height),B.drawZBar(),B.draw("dec"));for(w=0;w<H.length;w++)s.strokeStyle=H[w].color,H[w].draw(),s.strokeStyle="black";W(" "),X(" ")}B.curpos(),X(" ")}),sop=new Object,sop.sin="s",sop.cos="c",sop.tan="t",sop.pi="p",sop.cosec="o",sop.sec="d",sop.cot="u",sop.log="l",sop.asin="q",sop.acos="r",sop.atan="k",fns=["q","r","k","s","c","t","o","d","u","l"],opers=new Object,opers["^"]=1,opers["/"]=2,opers["*"]=2,opers["+"]=3,opers["-"]=3,ops=["asin","acos","atan","sin","cosec","cos","sec","tan","cot","pi","log"],lbrac=["(","{","[","|"],rbrac=[")","}","]","|"]});