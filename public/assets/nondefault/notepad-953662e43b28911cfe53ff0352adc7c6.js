$(function(){function u(a,c,d,e){b.beginPath(),b.moveTo(a,c),b.lineTo(d,e),b.stroke(),b.closePath()}var a=$("#notepad")[0],b=a.getContext("2d"),c,d,e,f,g=!1,h=!1,j=!1,k=!1,l=!1,m=!1,n=!1,o=!1,p=!1,q=!1,r="",s="",t={curpage:-1,notes:new Array,pixarr:new Array,lheight:20,margin:50,com:new Array,cline:-1,upper:50,addpad:function(a,b,c){this.notes=a,this.com=b,this.pixarr=c,this.curpage=this.notes.length-1,this.createpage()},npad:function(){this.createpage()},drawlines:function(){b.strokeStyle="#0083ad",u(this.margin-2,0,this.margin-2,a.height),u(this.margin,0,this.margin,a.height);for(i=this.upper;i<a.height;i+=this.lheight)u(0,i,a.width,i);b.strokeStyle="black",b.font="9pt Calibri",this.curpage==0?$(".prev").hide():$(".prev").show(),b.fillText(""+(this.curpage+1),a.width-10,a.height-5)},createpage:function(){this.curpage+1<this.notes.length&&this.notes.splice(this.curpage+1,0,new Array),b.clearRect(0,0,a.width,a.height),this.curpage+=1,this.drawlines(),this.notes[this.curpage]=new Array,this.com[this.curpage]=new Array,this.pixarr[this.curpage]=new Array,$("#notes").attr("style","background-color:transparent; position:absolute; left:"+(this.margin+5)+"px; top:"+this.upper+"px; width:"+(a.width-this.margin-20)+"px"),$("#notes").focus()},addline:function(b){this.notes[this.curpage].length<(a.height-this.upper)/this.lheight-2?(this.notes[this.curpage].push(b),this.displaylastline(b)):(this.createpage(),this.notes[this.curpage].push(b),this.displaylastline(b))},displaylastline:function(a){b.font="10pt Courier",b.fillText(a,this.margin+5,this.upper+this.notes[this.curpage].length*this.lheight-2)},addf:function(b,c,d){lt=1+Math.max(b.length,c.length);var e="<table id=addtable border=0>\n";e+="<tr>\n";for(i=0;i<lt-b.length;i++)e+="<td> </td>\n";for(i=0;i<b.length;i++)e+="<td>"+b[i]+"</td>\n";e+="</tr>\n",e+="<tr>\n";for(i=0;i<lt-c.length;i++)i==0?e+="<td>"+d+"</td>\n":e+="<td> </td>\n";for(i=0;i<c.length;i++)e+="<td>"+c[i]+"</td>\n";e+="</tr>\n",e+="<tr>\n";for(i=0;i<lt;i++)e+="<td><input type=text class=inps id=in"+i+' style="width:15px; height:10px"></td>\n';e+="</tr>\n",e+="</table>",$("#note").append(e),$("#addtable").attr("style","background-color:transparent; font:10pt Courier; position:absolute; left:"+(this.margin+5)+"px; top:"+(this.upper+this.lheight*this.notes[this.curpage].length+5)+"px;"),$("#in"+(lt-1)).select(),$(".inps").keypress(function(e){var f="";if(e.keyCode==13){for(var g=0;g<lt;g++)f+=$("#in"+g).attr("value");space="";for(g=0;g<lt-b.length;g++)space+=" ";t.addline(" "+space+b),space="";for(g=0;g<lt-c.length;g++)space+=" ";t.addline(d+""+space+c),space="";for(g=0;g<lt-f.length;g++)space+=" ";u(t.margin+2,t.upper+t.notes[t.curpage].length*t.lheight,t.margin+2+10*(1+f.length+space.length),t.upper+t.notes[t.curpage].length*t.lheight),t.addline(" "+space+f),$("#addtable").remove(),$("#notes").show(),$("#notes").attr("style","background-color:transparent; position:absolute; left:"+(t.margin+5)+"px; top:"+(t.upper+t.lheight*t.notes[t.curpage].length)+"px; width:"+(a.width-t.margin-20)+"px"),$("#notes").attr("value",""),$("#notes").focus(),d=="+"?k=!1:l=!1,j=!1}});for(var f=1;f<lt;f++)$("#in"+f).keypress({j:f},function(a){a.keyCode!=13&&$("#in"+(a.data.j-1)).select()})},multf:function(b,c){lt=1+b.length+c.length;var d="<table id=addtable border=0>\n";d+="<tr>\n";for(f=0;f<lt-b.length;f++)d+="<td> </td>\n";for(f=0;f<b.length;f++)d+="<td>"+b[f]+"</td>\n";d+="</tr>\n",d+="<tr>\n";for(f=0;f<lt-c.length;f++)f==0?d+="<td>x</td>\n":d+="<td> </td>\n";for(f=0;f<c.length;f++)d+="<td>"+c[f]+"</td>\n";d+="</tr>\n";for(e=0;e<c.length;e++){d+="<tr>\n";for(f=0;f<lt-(b.length+e+1);f++)f==0&&e!=0?d+="<td>+</td>\n":d+="<td> </td>\n";for(f=0;f<b.length+e+1;f++)d+="<td><input type=text class=inps"+e+" id=in_"+e+"_"+f+' style="width:15px; height:10px"></td>\n';d+="</tr>\n"}if(c.length>1)for(f=0;f<lt;f++)d+="<td><input type=text class=inps id=in"+f+' style="width:15px; height:10px"></td>\n';d+="</tr>\n",d+="</table>",$("#note").append(d),$("#addtable").attr("style","background-color:transparent; font:10pt Courier; position:absolute; left:"+(this.margin+5)+"px; top:"+(this.upper+this.lheight*this.notes[this.curpage].length+5)+"px;"),$("#in_0_"+b.length).select();for(e=0;e<c.length;e++)e==c.length-1?$(".inps"+e).keypress(function(a){a.keyCode==13&&$("#in"+(lt-1)).select()}):$(".inps"+e).keypress({j:e},function(a){if(a.keyCode==13){$("#in_"+(a.data.j+1)+"_"+b.length).select();for(f=0;f<e;f++)$("#in_"+(a.data.j+1)+"_"+(b.length+1+f)).attr("value","0")}});c.length==1?$(".inps0").keypress(function(d){var e="";if(d.keyCode==13){for(f=0;f<lt-b.length;f++)e+=" ";t.addline("  "+e+b),e="";for(f=0;f<lt-c.length;f++)e+=" ";t.addline("x "+e+c),u(t.margin+2,t.upper+t.notes[t.curpage].length*t.lheight,t.margin+2+10*(2+e.length),t.upper+t.notes[t.curpage].length*t.lheight),e="";for(var f=0;f<lt-1;f++)e+=$("#in_0_"+f).attr("value");var g="";for(var f=0;f<lt-e.length;f++)g+=" ";t.addline("= "+g+e),$("#addtable").remove(),$("#notes").show(),$("#notes").attr("style","background-color:transparent; position:absolute; left:"+(t.margin+5)+"px; top:"+(t.upper+t.lheight*t.notes[t.curpage].length)+"px; width:"+(a.width-t.margin-20)+"px"),$("#notes").attr("value",""),$("#notes").focus(),m=!1,j=!1}}):$(".inps").keypress(function(d){var e="";if(d.keyCode==13){for(h=0;h<lt-b.length;h++)e+=" ";t.addline(" "+e+b),e="";for(h=0;h<lt-c.length;h++)e+=" ";t.addline("x"+e+c),u(t.margin+2,t.upper+t.notes[t.curpage].length*t.lheight,t.margin+2+10*(e.length+c.length+1),t.upper+t.notes[t.curpage].length*t.lheight),e="";for(var f=0;f<c.length;f++){e="";for(h=0;h<b.length+f+1;h++)e+=$("#in_"+f+"_"+h).attr("value");var g="";for(h=0;h<lt-e.length;h++)g+=" ";f==0?e=" "+g+e:e="+"+g+e,t.addline(e)}u(t.margin+2,t.upper+t.notes[t.curpage].length*t.lheight,t.margin+2+10*e.length,t.upper+t.notes[t.curpage].length*t.lheight),e="";for(var h=0;h<lt;h++)e+=$("#in"+h).attr("value");g="";for(var h=0;h<lt-e.length;h++)g+=" ";t.addline(" "+g+e),$("#addtable").remove(),$("#notes").show(),$("#notes").attr("style","background-color:transparent; position:absolute; left:"+(t.margin+5)+"px; top:"+(t.upper+t.lheight*t.notes[t.curpage].length)+"px; width:"+(a.width-t.margin-20)+"px"),$("#notes").attr("value",""),$("#notes").focus(),m=!1,j=!1}});for(var e=1;e<lt;e++)$("#in"+e).keypress({j:e},function(a){a.keyCode!=13&&$("#in"+(a.data.j-1)).select()});for(var e=0;e<c.length;e++)for(var f=1;f<b.length+e+1;f++)$("#in_"+e+"_"+f).keypress({j:e,i:f},function(a){a.keyCode!=13&&$("#in_"+a.data.j+"_"+(a.data.i-1)).select()})},comm:function(a){this.cline=a,$("#comment").show(),this.com[this.curpage][this.cline]!=null&&$("#comment").attr("value",this.com[this.curpage][this.cline]),$("#comment").attr("style","position:absolute; left:"+this.margin+"px; top:"+(this.upper+a*this.lheight)+"px;"),p=!0,$("#comment").focus()},nppage:function(c){this.notes[this.curpage+c]!=null&&this.curpage+c!=this.notes.length-1?($("#notes").hide(),$(".plug").hide(),$(".tbreak").hide(),$(".placeholder").show()):this.curpage+c==this.notes.length-1&&($("#notes").show(),$(".plug").show(),$(".tbreak").show(),$(".placeholder").hide()),this.curpage+c>0&&($(".cmt"+this.curpage).hide(),j&&($("#num1").attr("value",""),$("#num2").attr("value",""),$("#num1").hide(),$("#num2").hide(),$("#num1lab").remove(),$("#num2lab").remove(),$("#addtable").remove(),j=!1,k=!1,m=!1,l=!1,n=!1,p=!1,$("#comment").attr("value","")));if(this.notes[this.curpage+c]==null&&this.curpage+c>=0)this.createpage();else if(this.curpage+c<0)alert("already at first page");else{this.curpage+=c,b.clearRect(0,0,a.width,a.height),this.drawlines();for(var d=0;d<this.notes[this.curpage].length;d++)b.font="10pt Courier",b.fillText(this.notes[this.curpage][d],this.margin+5,this.upper+(d+1)*this.lheight-2);b.lineWidth=2;for(var d=0;d<this.pixarr[this.curpage].length;d++)for(var e=1;e<this.pixarr[this.curpage][d].length;e++)u(this.pixarr[this.curpage][d][e-1][0],this.pixarr[this.curpage][d][e-1][1],this.pixarr[this.curpage][d][e][0],this.pixarr[this.curpage][d][e][1]);$(".cmt"+this.curpage).show(),b.lineWidth=1,$("#notes").focus()}}};t.npad(),$("#notes").focus(),$("#notepad").mousedown(function(b){e=c,f=d;if(p){$("#cmt_"+t.curpage+"_"+t.cline).remove(),t.com[t.curpage][t.cline]=$("#comment").attr("value");if($("#comment").attr("value")!=""){var i="<div class=cmt"+t.curpage+" id=cmt_"+t.curpage+"_"+t.cline+' style="position:absolute; left:'+(t.margin-20)+"px; top:"+(t.cline*t.lheight+t.upper+4)+'px;">\n';i+='<i class="icon-comment"></i>',i+="</div>",$("#note").append(i),$("#cmt_"+t.curpage+"_"+t.cline).click({cline:t.cline},function(a){t.comm(a.data.cline)})}$("#comment").attr("value",""),$("#comment").attr("style","display:none;"),p=!1}f<a.height-20&&e>50&&f>50&&!p&&($("#note").css("cursor","pointer"),t.pixarr[t.curpage].push(new Array),t.pixarr[t.curpage][t.pixarr[t.curpage].length-1].push([e,f]),h=!0),g=!0}),$(".prev").mousedown(function(a){t.nppage(-1)}),$(".next").mousedown(function(a){t.nppage(1)}),$("#notepad").mouseup(function(a){g=!1,q=!1,h=!1,$("#note").css("cursor","default"),$("#notes").focus()}),$("#notepad").scroll(function(a){}),$("#notepad").mousemove(function(e){var f=$("#notepad").offset(),g=Math.round(f.left),i=Math.round(f.top);c=e.pageX-g,d=e.pageY-i,h&&d<a.height-20&&c>50&&d>50&&(q=!0,b.lineWidth=2,cpa=t.pixarr[t.curpage],u(cpa[cpa.length-1][cpa[cpa.length-1].length-1][0],cpa[cpa.length-1][cpa[cpa.length-1].length-1][1],c,d),t.pixarr[t.curpage][t.pixarr[t.curpage].length-1].push([c,d]),b.lineWidth=1)}),$("#notepad").dblclick(function(a){if(t.notes.length-1!=t.curpage&&f>t.upper&&!q&&e<t.margin){var b=Math.floor((f-t.upper)/t.lheight);t.comm(b)}}),$("#notes").keypress(function(b){b.keyCode==13&&(t.addline($("#notes").attr("value")),$("#notes").attr("style","background-color:transparent; position:absolute; left:"+(t.margin+5)+"px; top:"+(t.upper+t.lheight*t.notes[t.curpage].length)+"px; width:"+(a.width-t.margin-20)+"px"),$("#notes").attr("value",""))}),$("#add").click(function(){j||($("#num1lab").remove(),$("#num2lab").remove(),t.addline(" "),$("#notes").hide(),$("#num1").show(),$("#num2").show(),$("#num1").attr("style","background-color:transparent; position:absolute; left:"+(t.margin+105)+"px; top:"+(t.upper+t.lheight*t.notes[t.curpage].length)+"px; width:150px"),$("#num2").attr("style","background-color:transparent; position:absolute; left:"+(t.margin+105)+"px; top:"+(t.upper+t.lheight*(2+t.notes[t.curpage].length))+"px; width:150px"),$("#note").append('<label id=num1lab for=num1 style="background-color:transparent; font:10pt Courier; position:absolute; left:'+(t.margin+5)+"px; top:"+(3+t.upper+t.lheight*t.notes[t.curpage].length)+'px; width:150px">1st Number =</label>\n<label id=num2lab for=num2 style="background-color:transparent; font:10pt Courier; position:absolute; left:'+(t.margin+5)+"px; top:"+(3+t.upper+t.lheight*(2+t.notes[t.curpage].length))+'px; width:150px">2nd Number =</label>'),$("#num1").focus(),j=!0,k=!0)}),$("#sub").click(function(){j||($("#num1lab").remove(),$("#num2lab").remove(),t.addline(" "),$("#notes").hide(),$("#num1").show(),$("#num2").show(),$("#num1").attr("style","background-color:transparent; position:absolute; left:"+(t.margin+105)+"px; top:"+(t.upper+t.lheight*t.notes[t.curpage].length)+"px; width:150px"),$("#num2").attr("style","background-color:transparent; position:absolute; left:"+(t.margin+105)+"px; top:"+(t.upper+t.lheight*(2+t.notes[t.curpage].length))+"px; width:150px"),$("#note").append('<label id=num1lab for=num1 style="background-color:transparent; font:10pt Courier; position:absolute; left:'+(t.margin+5)+"px; top:"+(3+t.upper+t.lheight*t.notes[t.curpage].length)+'px; width:150px">1st Number =</label>\n<label id=num2lab for=num2 style="background-color:transparent; font:10pt Courier; position:absolute; left:'+(t.margin+5)+"px; top:"+(3+t.upper+t.lheight*(2+t.notes[t.curpage].length))+'px; width:150px">2nd Number =</label>'),$("#num1").focus(),j=!0,l=!0)}),$("#mult").click(function(){j||($("#num1lab").remove(),$("#num2lab").remove(),t.addline(" "),$("#notes").hide(),$("#num1").show(),$("#num2").show(),$("#num1").attr("style","background-color:transparent; position:absolute; left:"+(t.margin+105)+"px; top:"+(t.upper+t.lheight*t.notes[t.curpage].length)+"px; width:150px"),$("#num2").attr("style","background-color:transparent; position:absolute; left:"+(t.margin+105)+"px; top:"+(t.upper+t.lheight*(2+t.notes[t.curpage].length))+"px; width:150px"),$("#note").append('<label id=num1lab for=num1 style="background-color:transparent; font:10pt Courier; position:absolute; left:'+(t.margin+5)+"px; top:"+(t.upper+t.lheight*t.notes[t.curpage].length+3)+'px; width:150px">1st Number =</label>\n<label id=num2lab for=num2 style="background-color:transparent; font:10pt Courier; position:absolute; left:'+(t.margin+5)+"px; top:"+(3+t.upper+t.lheight*(2+t.notes[t.curpage].length))+'px; width:150px">2nd Number =</label>'),$("#num1").focus(),j=!0,m=!0)}),$("#num1").keypress(function(a){a.keyCode==13&&$("#num2").focus()}),$("#num2").keypress(function(a){if(a.keyCode==13){var b=$("#num1").attr("value"),c=$("#num2").attr("value");k?t.addf(b,c,"+"):m?t.multf(b,c):l&&t.addf(b,c,"-"),$("#num1").attr("value",""),$("#num2").attr("value",""),$("#num1").hide(),$("#num2").hide(),$("#num1lab").remove(),$("#num2lab").remove()}})})