function fnc(e,t){cur_fn+=1,this.exp=e,this.parsed=parseFN(this.exp),t==null?this.color=freeColor():this.color=t,this.lwidth=1,this.thick=!1,this.update=function(){this.pos=fnarr.index(this),this.side_html=fn_side_html(this.pos),fn_callbacks(this.pos)},this.update(),this.evaluate=function(){evaluate(this.pos)},this.evaluate_at_x=function(e){return evaluatefn(this.parsed,e)},this.draw=function(){return context.lineWidth=this.lwidth,this.ret=drawfunction(this.fn),context.lineWidth=1,this.values=this.ret[0],this.pos=this.ret[1],this.values}}function operation(e,t,n){if(e=="+")return t+n;if(e=="-")return n-t;if(e=="*")return t*n;if(e=="/")return n/t;if(e=="^")return Math.pow(n,t);if(e=="q")return Math.asin(t);if(e=="r")return Math.acos(t);if(e=="k")return Math.atan(t);if(e=="s")return Math.sin(t);if(e=="c")return Math.cos(t);if(e=="t")return Math.tan(t);if(e=="u")return 1/Math.tan(t);if(e=="d")return 1/Math.cos(t);if(e=="o")return 1/Math.sin(t);if(e=="l")return Math.log(t)}function isOperator(e){return opers[e]!=null?!0:!1}function parseFN(e){for(i=0;i<e.length;i++)e.charAt(i)==" "&&(e=e.substr(0,i)+e.substr(i,e.length));for(i=0;i<ops.length;i++)while(e.indexOf(ops[i])!=-1)e=e.substr(0,e.indexOf(ops[i]))+sop[ops[i]]+e.substr(e.indexOf(ops[i])+ops[i].length,e.length);tokens=new Array,e[0]=="-"&&(e="0"+e);for(i=0;i<ops.length;i++)e[i]=="-"&&e[i-1]=="("&&(e=e.substr(0,i)+"0"+e.substr(i,e.length));var n=new queue,r=new Array;for(i=0;i<e.length;i+=1){var s=e.charAt(i);tokens.push(e.charAt(i));if(e.charAt(i)=="x")(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="p"||tokens[tokens.length-2]=="e"||tokens[tokens.length-2]=="x")&&r.push("*"),n.enqueue("x");else if(e.charAt(i)=="p")n.enqueue(Math.PI),(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="x"||tokens[tokens.length-2]=="e")&&r.push("*");else if(e.charAt(i)=="e"){if(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="x"||tokens[tokens.length-2]=="p")r.push("*"),n.enqueue(Math.E)}else if(!isNaN(s)){var o=+s,u=2;s=e.substr(i,u);while(!isNaN(s)&&u+i<=e.length)o=+s,u+=1,s=e.substr(i,u);i=i+u-2,n.enqueue(o)}else if(fns.indexOf(e.charAt(i))!=-1){if(lbrac.indexOf(e.charAt(i+1))==-1)return alert("Error: There has to be a bracket after trignometric, log functions"),!1;r.push(e.charAt(i))}else if(isOperator(e.charAt(i))){while(r.length!=0&&isOperator(r[r.length-1])){if(["+","-","*","/"].indexOf(e.charAt(i))!=-1){if(!(opers[e.charAt(i)]>=opers[r[r.length-1]]))break;n.enqueue(r.pop())}if(e.charAt(i)=="^"){if(!(opers[e.charAt(i)]>opers[r[r.length-1]]))break;n.enqueue(r.pop())}}r.push(e.charAt(i))}else if(lbrac.indexOf(e.charAt(i))!=-1)(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="x"||tokens[tokens.length-2]=="p"||tokens[tokens.length-2]=="e"||rbrac.indexOf(tokens[tokens.length-2])!=-1)&&r.push("*"),r.push(e.charAt(i));else{if(rbrac.indexOf(e.charAt(i))==-1)return alert("Error: symbol not recognized"),!1;while(r[r.length-1]!=lbrac[rbrac.indexOf(e.charAt(i))]){if(r.length==0)return alert("Error: mismatched parentheses"),!1;n.enqueue(r.pop())}r.pop(),fns.indexOf(r[r.length-1])!=-1&&n.enqueue(r.pop())}}while(r.length!=0){if(r[r.length-1]=="(")return alert("Error: mismatched parentheses"),!1;t=r.pop(),n.enqueue(t)}var a=n.arr();return a}function freeColor(){var e="";for(var t=0;t<ccolor.length;t++)if(!ccolor[t]){e=COLOR[t],ccolor[t]=!0;break}return e==""&&(COLOR.push(get_random_color()),e=COLOR[COLOR.length-1],ccolor[t]=!0),e}var canvas=$("#canvas")[0],curve=$("#curves"),context=canvas.getContext("2d"),mousex,mousey,downx,downy,mousedown=!1;cur_fn=0,fnarr=[],fn_side_html=function(e){return h='<div class=shape style="background-color:'+fnarr[e].color+';" id=s_'+e+" >\ny="+fnarr[e].exp,h+='\n<i class="icon-remove-sign icon-white deleteb" id=delete_'+e+"></i>\n",h+="</div>\n",h},evaluatefn=function(e,t){form=new Array;for(i=0;i<e.length;i++)isNaN(e[i])?e[i]=="x"?form.push(t):fns.indexOf(e[i])!=-1?form.push(operation(e[i],form.pop(),0)):form.push(operation(e[i],form.pop(),form.pop())):form.push(e[i]);return form[0]},evaluate=function(e){sy=fnarr[e];var t=new Array,n=new Array,r,i;for(q=off;q<canvas.width-off;q+=1)xpos=q,curx=czoom*(xpos-cx)/width,cury=evaluatefn(sy,curx)/czoom,ypos=cy-width*cury,ypos>=0&&ypos<=canvas.height+off&&(t.push([curx,cury]),n.push([q,Math.round(ypos)]),q>off&&(Math.abs(distance(i[0],i[1],curx,cury))<2*czoom?drawLine(r[0],r[1],xpos,ypos):context.fillRect(xpos,ypos,1,1))),r=[xpos,ypos],i=[curx,cury];return[t,n]},fn_callbacks=function(e){$("#s_"+e).mouseenter({w:e},function(e){fnarr[e.data.w].lwidth=3,redraw()}),$("#s_"+e).click({w:e},function(e){fnarr[e.data.w].thick?(fnarr[e.data.w].lwidth=1,redraw(),fnarr[e.data.w].thick=!1):(fnarr[e.data.w].lwidth=3,fnarr[e.data.w].thick=!0,redraw())}),$("#s_"+e).mouseleave({w:e},function(e){fnarr[e.data.w].lwidth=1,redraw()}),$("#delete_"+e).click({w:e},function(e){deleteCurve(e.data.w)})},sop=new Object,sop.sin="s",sop.cos="c",sop.tan="t",sop.pi="p",sop.cosec="o",sop.sec="d",sop.cot="u",sop.log="l",sop.asin="q",sop.acos="r",sop.atan="k",fns=["q","r","k","s","c","t","o","d","u","l"],opers=new Object,opers["^"]=1,opers["/"]=2,opers["*"]=2,opers["+"]=3,opers["-"]=3,ops=["asin","acos","atan","sin","cosec","cos","sec","tan","cot","pi","log"],lbrac=["(","{","[","|"],rbrac=[")","}","]","|"],COLOR=["#049cdb","#46a546","#9d261d","#f89406","#c3325f","#7a43b6","#ffc40d"],ccolor=new Array;for(var a=0;a<COLOR.length;a++)ccolor[a]=!1;