$(function(){function M(){var a="0123456789ABCDEF".split(""),b="#";for(var c=0;c<6;c++)b+=a[Math.round(Math.random()*15)];return b}function N(){var a="";for(var b=0;b<ccolor.length;b++)if(!ccolor[b]){a=COLOR[b],ccolor[b]=!0;break}return a==""&&(COLOR.push(M()),a=COLOR[COLOR.length-1],ccolor[b]=!0),a}function O(a){ccolor[COLOR.indexOf(K[a].color)]=!1,e.splice(a,1),K.splice(a,1);var b="";for(var d=0;d<K.length;d++)K[d].html='<div class=shapes style="background-color:'+K[d].color+';" id=s_'+d+" >"+K[d].fn+"</div>\n",K[d].html+="<button id=delete_"+d+"> Delete </button>\n",b+=K[d].html;c.html(b),Q(),R()}function P(a){var b=a,g=N();d.strokeStyle=g,dd=new ba(b,g);if(dd.ret==0)return ccolor[COLOR.indexOf(g)]=!1,!1;K.push(dd);var h='<div class=shapes style="background-color:'+g+';" id=s_'+(K.length-1)+" >"+K[K.length-1].fn+"</div>\n";h+="<button id=delete_"+(K.length-1)+"> Delete </button>\n",K[K.length-1].html=h,e[K.length-1]=!1,d.strokeStyle="black",f="";for(k=0;k<K.length;k++)f+=K[k].html;c.html(f),$("#circlesize").val(""),Q(),R()}function Q(){for(w=0;w<K.length;w++)$("#s_"+w).mouseenter({w:w},function(a){e[a.data.w]||(K[a.data.w].lwidth=3,R())}),$("#s_"+w).click({w:w},function(a){e[a.data.w]?(K[a.data.w].lwidth=1,R(),e[a.data.w]=!1):(K[a.data.w].lwidth=3,e[a.data.w]=!0,R())}),$("#s_"+w).mouseleave({w:w},function(a){e[a.data.w]||(K[a.data.w].lwidth=1,R())}),$("#delete_"+w).click({w:w},function(a){O(a.data.w)})}function R(){d.clearRect(0,0,b.width,b.height),L.draw("dec"),L.drawZBar();for(w=0;w<K.length;w++)d.strokeStyle=K[w].color,K[w].draw(),d.strokeStyle="black";S(" "),T(" "),d.clearRect(0,0,d.width,25),d.clearRect(0,d.height-25,d.width,25)}function S(a){d.clearRect(0,0,b.width,25),d.font="10pt Calibri",d.fillStyle="black",d.fillText(a,10,20)}function T(a){d.clearRect(0,b.height-25,b.width,25),d.font="10pt Calibri",d.fillStyle="black",d.fillText(a,10,20)}function U(a){d.clearRect(b.width/2,0,b.width/2,25),d.font="10pt Calibri",d.fillStyle="black",d.fillText(a,b.width/2+10,20)}function V(a,b){return b==0?a:a<b?V(b,a):V(a-b,b)}function W(a,b,c){d.clearRect(b-5,c,b+5,c+10),d.font="12pt Calibri",d.fillStyle="black",d.fillText(a,b-7,c+15)}function X(a,b,c){d.beginPath(),d.arc(a,b,c,0,2*Math.PI,!1),d.closePath(),d.stroke()}function Y(a,b,c,e){d.beginPath(),d.moveTo(a,b),d.lineTo(c,e),d.stroke(),d.closePath()}function Z(a,b){form=new Array;for(i=0;i<a.length;i++)isNaN(a[i])?a[i]=="x"?form.push(b):fns.indexOf(a[i])!=-1?form.push(bb(a[i],form.pop(),0)):form.push(bb(a[i],form.pop(),form.pop())):form.push(a[i]);return form[0]}function _(a){sy=bd(a);if(sy==0)return!1;var c=new Array,e=new Array,f,g;for(q=o;q<b.width-o;q+=1)xpos=q,curx=J*(xpos-G)/I,cury=Z(sy,curx)/J,ypos=H-I*cury,ypos>=0&&ypos<=b.height+o&&(c.push([curx,cury]),e.push([q,Math.round(ypos)]),q>o&&(Math.abs(bf(g[0],g[1],curx,cury))<2*J?Y(f[0],f[1],xpos,ypos):d.fillRect(xpos,ypos,1,1))),f=[xpos,ypos],g=[curx,cury];return[c,e]}function ba(a,b){this.fn=a,this.html="",this.lwidth=1,this.ret=_(a);if(this.ret==0)return!1;this.color=b,this.values=this.ret[0],this.pos=this.ret[1],this.draw=function(){return d.lineWidth=this.lwidth,this.ret=_(this.fn),d.lineWidth=1,this.values=this.ret[0],this.pos=this.ret[1],this.values}}function bb(a,b,c){if(a=="+")return b+c;if(a=="-")return c-b;if(a=="*")return b*c;if(a=="/")return c/b;if(a=="^")return Math.pow(c,b);if(a=="q")return Math.asin(b);if(a=="r")return Math.acos(b);if(a=="k")return Math.atan(b);if(a=="s")return Math.sin(b);if(a=="c")return Math.cos(b);if(a=="t")return Math.tan(b);if(a=="u")return 1/Math.tan(b);if(a=="d")return 1/Math.cos(b);if(a=="o")return 1/Math.sin(b);if(a=="l")return Math.log(b)}function bc(a){return opers[a]!=null?!0:!1}function bd(a){for(i=0;i<a.length;i++)a.charAt(i)==" "&&(a=a.substr(0,i)+a.substr(i,a.length));for(i=0;i<ops.length;i++)while(a.indexOf(ops[i])!=-1)a=a.substr(0,a.indexOf(ops[i]))+sop[ops[i]]+a.substr(a.indexOf(ops[i])+ops[i].length,a.length);tokens=new Array,a[0]=="-"&&(a="0"+a);for(i=0;i<ops.length;i++)a[i]=="-"&&a[i-1]=="("&&(a=a.substr(0,i)+"0"+a.substr(i,a.length));var b=new be,c=new Array;for(i=0;i<a.length;i+=1){var d=a.charAt(i);tokens.push(a.charAt(i));if(a.charAt(i)=="x")(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="p"||tokens[tokens.length-2]=="e"||tokens[tokens.length-2]=="x")&&c.push("*"),b.enqueue("x");else if(a.charAt(i)=="p")b.enqueue(Math.PI),(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="x"||tokens[tokens.length-2]=="e")&&c.push("*");else if(a.charAt(i)=="e"){if(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="x"||tokens[tokens.length-2]=="p")c.push("*"),b.enqueue(Math.E)}else if(!isNaN(d)){var e=+d,f=2;d=a.substr(i,f);while(!isNaN(d)&&f+i<=a.length)e=+d,f+=1,d=a.substr(i,f);i=i+f-2,b.enqueue(e)}else if(fns.indexOf(a.charAt(i))!=-1){if(lbrac.indexOf(a.charAt(i+1))==-1)return alert("Error: There has to be a bracket after trignometric, log functions"),!1;c.push(a.charAt(i))}else if(bc(a.charAt(i))){while(c.length!=0&&bc(c[c.length-1])){if(["+","-","*","/"].indexOf(a.charAt(i))!=-1)if(opers[a.charAt(i)]>=opers[c[c.length-1]])b.enqueue(c.pop());else break;if(a.charAt(i)=="^")if(opers[a.charAt(i)]>opers[c[c.length-1]])b.enqueue(c.pop());else break}c.push(a.charAt(i))}else if(lbrac.indexOf(a.charAt(i))!=-1)(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="x"||tokens[tokens.length-2]=="p"||tokens[tokens.length-2]=="e"||rbrac.indexOf(tokens[tokens.length-2])!=-1)&&c.push("*"),c.push(a.charAt(i));else{if(rbrac.indexOf(a.charAt(i))==-1)return alert("Error: symbol not recognized"),!1;while(c[c.length-1]!=lbrac[rbrac.indexOf(a.charAt(i))]){if(c.length==0)return alert("Error: mismatched parentheses"),!1;b.enqueue(c.pop())}c.pop(),fns.indexOf(c[c.length-1])!=-1&&b.enqueue(c.pop())}}while(c.length!=0){if(c[c.length-1]=="(")return alert("Error: mismatched parentheses"),!1;t=c.pop(),b.enqueue(t)}var g=b.arr();return g}function be(){this.ar=new Array,this.start=0,this.end=this.ar.length,this.enqueue=function(a){this.ar[this.end]=a,this.end+=1},this.dequeue=function(){return this.start+=1,this.ar[this.start-1]},this.peek=function(){return this.ar[this.start]},this.arr=function(){var a=new Array;for(i=this.start;i<this.end;i++)a[i-this.start]=this.ar[i];return a},this.toString=function(){var a="";for(i=this.start;i<this.end;i+=1)a+=this.ar[i]+", ";return a},this.empty=function(){return this.end-this.start==0?!0:!1}}function bf(a,b,c,d){return xdiff=a-c,ydiff=b-d,Math.sqrt(xdiff*xdiff+ydiff*ydiff)}COLOR=["#049cdb","#46a546","#9d261d","#f89406","#c3325f","#7a43b6","#ffc40d"],ccolor=new Array;for(var a=0;a<COLOR.length;a++)ccolor[a]=!1;var b=$("#canvas")[0],c=$("#shapes"),d=b.getContext("2d"),e=new Array,g,h,j,l,n=!1,o=25,p,r=180,s=null,u=null,v=null,x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=null,F=null,G=b.width/2,H=b.height/2,I=0,J=1,K=new Array,L={num:10,centerx:b.width/2,centery:b.height/2,snum:10,mid:0,diff:1,zbarc:r,initz:r,zoomin:[1,.5,.25,.2,.1,.05],zoomout:[1,2,5,10,50,100],zoominf:[1,2,4,5,10,20],iewid:Math.floor((b.width-2*o)/100),ewid:Math.floor((b.width-2*o)/100),lower:40,upper:320,ldiv:20,fdiff:1,movemid:function(){var a=g-j,b=h-l;j=g,l=h,this.centerx+=a,this.centery+=b},zoom:function(a){this.ewid=(this.iewid-2.5)*(a/this.ldiv)+2.5,I=this.ewid*this.snum},moveZBar:function(){var a=h-l;l=h,a+this.zbarc<=this.upper-this.ldiv-1&&a+this.zbarc>=this.lower+this.ldiv+1&&(this.zbarc+=a,r=this.zbarc,this.zbarc<this.initz?(this.diff=this.zoomout[Math.floor((this.initz-this.zbarc)/this.ldiv)],J=this.diff,this.zoom(this.ldiv-(this.initz-this.zbarc)+Math.floor((this.initz-this.zbarc)/this.ldiv)*this.ldiv)):(this.diff=this.zoomin[Math.floor((this.zbarc-this.initz)/this.ldiv)],J=this.diff,this.fdiff=this.zoominf[Math.floor((this.zbarc-this.initz)/this.ldiv)],this.zoom(this.zbarc-this.initz-Math.floor((this.zbarc-this.initz)/this.ldiv)*this.ldiv)))},curpos:function(){m=this.ewid*this.snum,S("x="+Math.round(this.diff*(g-this.centerx)/m*100)/100+", y="+Math.round(this.diff*(this.centery-h)/m*100)/100)},drawZBar:function(){d.strokeStyle="black",Y(5,this.lower,5,this.upper),Y(5,this.upper,15,this.upper),Y(15,this.upper,15,this.lower),Y(15,this.lower,5,this.lower),Y(5,this.zbarc-this.ldiv,5,this.zbarc+this.ldiv),Y(5,this.zbarc+this.ldiv,15,this.zbarc+this.ldiv),Y(15,this.zbarc+this.ldiv,15,this.zbarc-this.ldiv),Y(15,this.zbarc-this.ldiv,5,this.zbarc-this.ldiv)},draw:function(a){d.strokeStyle="e3e3e3";var c=b.width-o,e=o;t=this.mid;var f=this.mid,g=0;for(i=this.centerx;i>=o;i-=this.ewid*this.snum){if(i<=b.width-o){g==0&&(u=t),g+=1,Y(i,o,i,b.height-o);if(i!=this.centerx)if(a=="dec"||this.diff>=1)d.font="9pt Calibri",d.fillStyle="black",(Math.round(t*1e3)/1e3).toString().length<2?d.fillText(Math.round(t*1e3)/1e3,i-5,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<3?d.fillText(Math.round(t*1e3)/1e3,i-10,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<4?d.fillText(Math.round(t*1e3)/1e3,i-15,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<5?d.fillText(Math.round(t*1e3)/1e3,i-20,this.centery+10):d.fillText(Math.round(t*1e3)/1e3,i-25,this.centery+10);else{var h=-f,j=this.fdiff,k=V(h,j);h=Math.round(h/k),j=Math.round(j/k),d.font="9pt Calibri",d.fillStyle="black",j!=1?(d.fillText(-h,i-9,this.centery+5),d.fillText("__",i-9,this.centery+5),d.fillText(j,i-9,this.centery+10)):d.fillText(-h,i-9,this.centery+5)}}s=t,t-=this.diff,f-=1}d.fillText(0,this.centerx-5,this.centery+10),f=this.mid,t=this.mid,g=0;for(i=this.centerx;i<=b.width-o;i+=this.ewid*this.snum){if(i>=o){g==0&&(v=t),g+=1,Y(i,o,i,b.height-o);if(i!=this.centerx)if(a=="dec"||this.diff>=1)d.font="9pt Calibri",d.fillStyle="black",(Math.round(t*1e3)/1e3).toString().length<2?d.fillText(Math.round(t*1e3)/1e3,i-5,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<3?d.fillText(Math.round(t*1e3)/1e3,i-10,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<4?d.fillText(Math.round(t*1e3)/1e3,i-15,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<5?d.fillText(Math.round(t*1e3)/1e3,i-20,this.centery+10):d.fillText(Math.round(t*1e3)/1e3,i-25,this.centery+10);else{var h=f,j=this.fdiff,k=V(h,j);h=Math.round(h/k),j=Math.round(j/k),d.font="9pt Calibri",d.fillStyle="black",j!=1?(d.fillText(h,i-9,this.centery+5),d.fillText("__",i-9,this.centery+5),d.fillText(j,i-9,this.centery+5)):d.fillText(-h,i-9,this.centery+5)}}x=t,t+=this.diff,f+=1}t=this.mid;var f=0;g=0;for(i=this.centery;i>=o;i-=this.ewid*this.snum){if(i<=b.width-o){g==0&&(A=t),g+=1,Y(o,i,b.width-o,i);if(i!=this.centery)if(a=="dec"||this.diff>=1)d.font="9pt Calibri",d.fillStyle="black",(Math.round(t*1e3)/1e3).toString().length<2?d.fillText(Math.round(t*1e3)/1e3,this.centerx-5,i+10):(Math.round(t*1e3)/1e3).toString().length<3?d.fillText(Math.round(t*1e3)/1e3,this.centerx-10,i+10):(Math.round(t*1e3)/1e3).toString().length<4?d.fillText(Math.round(t*1e3)/1e3,this.centerx-15,i+10):(Math.round(t*1e3)/1e3).toString().length<5?d.fillText(Math.round(t*1e3)/1e3,this.centerx-20,i+10):d.fillText(Math.round(t*1e3)/1e3,this.centerx-25,i+10);else{var h=-f,j=this.fdiff,k=V(h,j);h=Math.round(h/k),j=Math.round(j/k),d.font="9pt Calibri",d.fillStyle="black",j!=1?(d.fillText(-h,this.centerx-10,i-3),d.fillText("__",this.centerx-10,i-3),d.fillText(j,this.centerx-10,i+2)):d.fillText(-h,this.centerx-10,i)}}B=t,t+=this.diff,f+=1}f=0,t=this.mid,g=0;for(i=this.centery;i<=b.width-o;i+=this.ewid*this.snum){if(i>=o){g==0&&(z=t),g+=1,Y(o,i,b.width-o,i);if(i!=this.centerx)if(a=="dec"||this.diff>=1)d.font="9pt Calibri",d.fillStyle="black",(Math.round(t*1e3)/1e3).toString().length<2?d.fillText(Math.round(t*1e3)/1e3,this.centerx-5,i+10):(Math.round(t*1e3)/1e3).toString().length<3?d.fillText(Math.round(t*1e3)/1e3,this.centerx-10,i+10):(Math.round(t*1e3)/1e3).toString().length<4?d.fillText(Math.round(t*1e3)/1e3,this.centerx-15,i+10):(Math.round(t*1e3)/1e3).toString().length<5?d.fillText(Math.round(t*1e3)/1e3,this.centerx-20,i+10):d.fillText(Math.round(t*1e3)/1e3,this.centerx-25,i+10);else{var h=f,j=this.fdiff,k=V(h,j);h=Math.round(h/k),j=Math.round(j/k),d.font="9pt Calibri",d.fillStyle="black",j!=1?(d.fillText(h,this.centerx-10,i-3),d.fillText("__",this.centerx-10,i-3),d.fillText(j,this.centerx-10,i+2)):d.fillText(-h,this.centerx-10,i)}}y=t,t-=this.diff,f-=1}s!=null?E=s:E=v,x!=null?C=x:C=u,y!=null?F=y:F=A,B!=null?D=B:D=z,G=this.centerx,H=this.centery,I=this.ewid*this.snum}};L.draw("dec"),L.drawZBar(),$("#canvas").mousedown(function(a){j=g,l=h,n=!0}),$("#undo").click(function(){ccolor[COLOR.indexOf(K[K.length-1].color)]=!1,K.pop(),R();var a="";for(k=0;k<K.length;k++)a+=K[k].html;c.html(a)}),$("#function").click(function(){P($("#circlesize").attr("value")),S(" "),T(" "),d.clearRect(0,0,d.width,25),d.clearRect(0,d.height-25,d.width,25)}),$("#canvas").mouseup(function(a){n=!1}),$("#canvas").scroll(function(a){}),$("#canvas").mousemove(function(a){var c=$("#canvas").offset(),e=Math.round(c.left),f=Math.round(c.top);g=a.pageX-e,h=a.pageY-f;if(n){j>o&&(L.movemid(),d.clearRect(0,0,b.width,b.height),L.draw("dec"),L.drawZBar()),j>5&&j<20&&l>r-25&&l<r+25&&(L.moveZBar(),d.clearRect(0,0,b.width,b.height),L.drawZBar(),L.draw("dec"));for(w=0;w<K.length;w++)d.strokeStyle=K[w].color,K[w].draw(),d.strokeStyle="black";S(" "),T(" ")}L.curpos(),T(" ")}),sop=new Object,sop.sin="s",sop.cos="c",sop.tan="t",sop.pi="p",sop.cosec="o",sop.sec="d",sop.cot="u",sop.log="l",sop.asin="q",sop.acos="r",sop.atan="k",fns=["q","r","k","s","c","t","o","d","u","l"],opers=new Object,opers["^"]=1,opers["/"]=2,opers["*"]=2,opers["+"]=3,opers["-"]=3,ops=["asin","acos","atan","sin","cosec","cos","sec","tan","cot","pi","log"],lbrac=["(","{","[","|"],rbrac=[")","}","]","|"]})