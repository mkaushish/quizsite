$(function(){function m(a){var b=$("#canvas").offset(),e=Math.round(b.left),f=Math.round(b.top);c=a.pageX-e,d=a.pageY-f}function n(c){b.clearRect(0,0,a.width,30),b.font="12pt Calibri",b.fillStyle="black",b.fillText(c,10,25)}function o(a,b){return b==0?a:a<b?o(b,a):o(a-b,b)}function p(c,d,e,f){var g=Math.floor((a.width-2*h)/(c*d)),j;for(i=center;i>=h;i-=g)s(i,a.height-h,i,a.height-h-10),j=i;var k;for(i=center;i<=a.width-h;i+=g)s(i,a.height-h,i,a.height-h-10),k=i;t=f;for(i=center;i>=h;i-=g*d)s(i,a.height-h,i,a.height-h-20),b.fillText(t,i-5,a.height-10),t-=e;t=0;for(i=center;i<=a.width-h;i+=g*d)s(i,a.height-h,i,a.height-h-20),b.fillText(t,i-5,a.height-10),t+=e;s(j,a.height-h,k,a.height-h)}function q(a,c,d){b.clearRect(c-5,d,c+5,d+10),b.font="12pt Calibri",b.fillStyle="black",b.fillText(a,c-7,d+15)}function r(a,c,d){b.beginPath(),b.arc(a,c,d,0,2*Math.PI,!1),b.closePath(),b.stroke()}function s(a,c,d,e){b.beginPath(),b.moveTo(a,c),b.lineTo(d,e),b.stroke(),b.closePath()}function u(a,b,c,d){Shape.call(this),this.x1=a,this.y1=b,this.x2=c,this.y2=d,this.draw=function(){s(a,b,c,d)},this.set_p2=function(a,b){this.x2=a,this.y2=b,this.draw=function(){s(this.x1,this.y1,a,b)}},this.underMouse=function(){return!1},this.toString=function(){return"(Line from "+a+", "+b+" to "+c+", "+d+")"}}function v(a,b,c,d){var e=new u(a,b,c,d);return addShape(e)}function w(a,b,c,d){return xdiff=a-c,ydiff=b-d,Math.sqrt(xdiff*xdiff+ydiff*ydiff)}var a=$("#canvas")[0],b=a.getContext("2d"),c,d,e,f,g=!1,h=25,j,k=180,l={num:10,center:a.width/2,snum:10,mid:0,diff:1,bdivs:1e3,zbarc:k,initz:k,zoomin:[1,.5,.25,.2,.1,.05],zoominf:[1,2,4,5,10,20],zoomout:[1,2,5,10,50,100],ewid:Math.floor((a.width-2*h)/100),lower:40,upper:320,ldiv:20,fdiff:1,movemid:function(){var a=c-e;e=c,this.center+=a},zoom:function(){},moveZBar:function(){var a=d-f;f=d,a+this.zbarc<=this.upper-this.ldiv-1&&a+this.zbarc>=this.lower+this.ldiv+1&&(this.zbarc+=a,k=this.zbarc,this.zbarc<this.initz?this.diff=this.zoomout[Math.floor((this.initz-this.zbarc)/this.ldiv)]:(this.diff=this.zoomin[Math.floor((this.zbarc-this.initz)/this.ldiv)],this.fdiff=this.zoominf[Math.floor((this.zbarc-this.initz)/this.ldiv)]))},drawZBar:function(){s(5,this.lower,5,this.upper),s(5,this.upper,15,this.upper),s(15,this.upper,15,this.lower),s(15,this.lower,5,this.lower),s(5,this.zbarc-this.ldiv,5,this.zbarc+this.ldiv),s(5,this.zbarc+this.ldiv,15,this.zbarc+this.ldiv),s(15,this.zbarc+this.ldiv,15,this.zbarc-this.ldiv),s(15,this.zbarc-this.ldiv,5,this.zbarc-this.ldiv),n("The small divs are "+this.diff/10+" and the big divs are "+this.diff)},draw:function(c){var d=a.width-h,e=h,f=0;for(i=this.center;i>=h;i-=this.ewid)i<=a.width-h&&(s(i,a.height-h,i,a.height-h-10),f==0&&(e=i),f+=1),d=i;f=0;for(i=this.center;i<=a.width-h;i+=this.ewid)i>=h&&(s(i,a.height-h,i,a.height-h-10),f==0&&d>i&&(d=i),e<i&&(e=i),f+=1);t=this.mid;var f=this.mid;for(i=this.center;i>=h;i-=this.ewid*this.snum){if(i<=a.width-h){s(i,a.height-h,i,a.height-h-20);if(i!=this.center)if(c=="dec"||this.diff>=1)b.font="9pt Calibri",(Math.round(t*1e3)/1e3).toString().length<2?b.fillText(Math.round(t*1e3)/1e3,i-3,a.height-10):(Math.round(t*1e3)/1e3).toString().length<3?b.fillText(Math.round(t*1e3)/1e3,i-6,a.height-10):(Math.round(t*1e3)/1e3).toString().length<4?b.fillText(Math.round(t*1e3)/1e3,i-9,a.height-10):(Math.round(t*1e3)/1e3).toString().length<5?b.fillText(Math.round(t*1e3)/1e3,i-12,a.height-10):b.fillText(Math.round(t*1e3)/1e3,i-15,a.height-10);else{var g=-f,j=this.fdiff,k=o(g,j);g=Math.round(g/k),j=Math.round(j/k),b.font="9pt Calibri",j!=1?(b.fillText(-g,i-9,a.height-15),b.fillText("__",i-9,a.height-15),b.fillText(j,i-9,a.height-4)):b.fillText(-g,i-9,a.height-10)}}t-=this.diff,f-=1}f=0,t=this.mid;for(i=this.center;i<=a.width-h;i+=this.ewid*this.snum){if(i>=h){s(i,a.height-h,i,a.height-h-20);if(c=="dec"||this.diff>=1)b.font="9pt Calibri",(Math.round(t*1e3)/1e3).toString().length<2?b.fillText(Math.round(t*1e3)/1e3,i-3,a.height-10):(Math.round(t*1e3)/1e3).toString().length<3?b.fillText(Math.round(t*1e3)/1e3,i-6,a.height-10):(Math.round(t*1e3)/1e3).toString().length<4?b.fillText(Math.round(t*1e3)/1e3,i-9,a.height-10):(Math.round(t*1e3)/1e3).toString().length<5?b.fillText(Math.round(t*1e3)/1e3,i-12,a.height-10):b.fillText(Math.round(t*1e3)/1e3,i-15,a.height-10);else{var g=f,j=this.fdiff,k=o(g,j);g=Math.round(g/k),j=Math.round(j/k),b.font="9pt Calibri",j!=1?(b.fillText(g,i-9,a.height-15),b.fillText("__",i-9,a.height-15),b.fillText(j,i-9,a.height-4)):b.fillText(-g,i-9,a.height-10)}}t+=this.diff,f+=1}s(d,a.height-h,e,a.height-h)}};l.draw("frac"),l.drawZBar(),$("#canvas").mousedown(function(a){e=c,f=d,g=!0}),$("#canvas").mouseup(function(a){g=!1}),$("#canvas").mousemove(function(c){m(c),g&&(f>a.height-75&&(l.movemid(),b.clearRect(0,0,a.width,a.height),l.draw("frac"),l.drawZBar()),e>5&&e<20&&f>k-25&&f<k+25&&(l.moveZBar(),b.clearRect(0,0,a.width,a.height),l.drawZBar(),l.draw("frac")))})})