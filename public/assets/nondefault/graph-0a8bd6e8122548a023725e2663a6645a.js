$(function(){function I(){var a="0123456789ABCDEF".split(""),b="#";for(var c=0;c<6;c++)b+=a[Math.round(Math.random()*15)];return b}function J(){b.clearRect(0,0,a.width,a.height),H.draw("dec"),H.drawZBar();for(w=0;w<G.length;w++)b.strokeStyle=G[w].color,G[w].draw(),b.strokeStyle="black"}function K(c){b.clearRect(0,0,a.width/2,25),b.font="10pt Calibri",b.fillStyle="black",b.fillText(c,10,20)}function L(c){b.clearRect(a.width/2,0,a.width/2,25),b.font="10pt Calibri",b.fillStyle="black",b.fillText(c,a.width/2+10,20)}function M(a,b){return b==0?a:a<b?M(b,a):M(a-b,b)}function N(a,c,d){b.clearRect(c-5,d,c+5,d+10),b.font="12pt Calibri",b.fillStyle="black",b.fillText(a,c-7,d+15)}function O(a,c,d){b.beginPath(),b.arc(a,c,d,0,2*Math.PI,!1),b.closePath(),b.stroke()}function P(a,c,d,e){b.beginPath(),b.moveTo(a,c),b.lineTo(d,e),b.stroke(),b.closePath()}function Q(a,b){form=new Array;for(i=0;i<a.length;i++)isNaN(a[i])?a[i]=="x"?form.push(b):fns.indexOf(a[i])!=-1?form.push(T(a[i],form.pop(),0)):form.push(T(a[i],form.pop(),form.pop())):form.push(a[i]);return form[0]}function R(c){sy=V(c);var d=new Array,f=new Array;for(q=j;q<a.width-j;q+=1){xpos=q,curx=F*(xpos-C)/E,cury=Q(sy,curx)/F,ypos=D-E*cury,ypos>j&&ypos<a.height-j&&(d.push([curx,cury]),f.push([q,Math.round(ypos)])),ke=f[0],ve=d[0];for(e=0;e<f.length;e++)Math.abs(X(ve[0],ve[1],d[e][0],d[e][1]))<2*F?P(ke[0],ke[1],f[e][0],f[e][1]):b.fillRect(f[e][0],f[e][1]),ke=f[e],ve=d[e]}return[d,f]}function S(a,b){this.fn=a,this.ret=R(a),this.color=b,this.values=this.ret[0],this.pos=this.ret[1],this.draw=function(){return this.ret=R(this.fn),this.values=this.ret[0],this.pos=this.ret[1],this.values}}function T(a,b,c){if(a=="+")return b+c;if(a=="-")return c-b;if(a=="*")return b*c;if(a=="/")return c/b;if(a=="^")return Math.pow(c,b);if(a=="s")return Math.sin(b);if(a=="c")return Math.cos(b);if(a=="t")return Math.tan(b);if(a=="u")return 1/Math.tan(b);if(a=="d")return 1/Math.cos(b);if(a=="o")return 1/Math.sin(b);if(a=="l")return Math.log(b)}function U(a){return opers[a]!=null?!0:!1}function V(a){for(i=0;i<a.length;i++)a.charAt(i)==" "&&(a=a.substr(0,i)+a.substr(i,a.length));for(i=0;i<ops.length;i++)while(a.indexOf(ops[i])!=-1)a=a.substr(0,a.indexOf(ops[i]))+sop[ops[i]]+a.substr(a.indexOf(ops[i])+ops[i].length,a.length);tokens=new Array,a[0]=="-"&&(a="0"+a);for(i=0;i<ops.length;i++)a[i]=="-"&&a[i-1]=="("&&(a=a.substr(0,i)+"0"+a.substr(i,a.length));var b=new W,c=new Array;for(i=0;i<a.length;i+=1){var d=a.charAt(i);tokens.push(a.charAt(i));if(a.charAt(i)=="x")(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="p"||tokens[tokens.length-2]=="e"||tokens[tokens.length-2]=="x")&&c.push("*"),b.enqueue("x");else if(a.charAt(i)=="p")b.enqueue(Math.PI),(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="x"||tokens[tokens.length-2]=="e")&&c.push("*");else if(a.charAt(i)=="e"){if(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="x"||tokens[tokens.length-2]=="p")c.push("*"),b.enqueue(Math.E)}else if(!isNaN(d)){var e=+d,f=2;d=a.substr(i,f);while(!isNaN(d)&&f+i<=a.length)e=+d,f+=1,d=a.substr(i,f);i=i+f-2,b.enqueue(e)}else if(fns.indexOf(a.charAt(i))!=-1)c.push(a.charAt(i));else if(U(a.charAt(i))){while(c.length!=0&&U(c[c.length-1])){if(["+","-","*","/"].indexOf(a.charAt(i))!=-1)if(opers[a.charAt(i)]>=opers[c[c.length-1]])b.enqueue(c.pop());else break;if(a.charAt(i)=="^")if(opers[a.charAt(i)]>opers[c[c.length-1]])b.enqueue(c.pop());else break}c.push(a.charAt(i))}else if(a.charAt(i)=="(")(!isNaN(tokens[tokens.length-2])||tokens[tokens.length-2]=="x"||tokens[tokens.length-2]=="p"||tokens[tokens.length-2]=="e"||tokens[tokens.length-2]==")")&&c.push("*"),c.push(a.charAt(i));else{if(a.charAt(i)!=")")return"Error: symbol not recognized";while(c[c.length-1]!="("){if(c.length==0)return"Error: mismatched parentheses";b.enqueue(c.pop())}c.pop(),fns.indexOf(c[c.length-1])!=-1&&b.enqueue(c.pop())}}while(c.length!=0){if(c[c.length-1]=="(")return"Error: mismatched parentheses";t=c.pop(),b.enqueue(t)}var g=b.arr();return g}function W(){this.ar=new Array,this.start=0,this.end=this.ar.length,this.enqueue=function(a){this.ar[this.end]=a,this.end+=1},this.dequeue=function(){return this.start+=1,this.ar[this.start-1]},this.peek=function(){return this.ar[this.start]},this.arr=function(){var a=new Array;for(i=this.start;i<this.end;i++)a[i-this.start]=this.ar[i];return a},this.toString=function(){var a="";for(i=this.start;i<this.end;i+=1)a+=this.ar[i]+", ";return a},this.empty=function(){return this.end-this.start==0?!0:!1}}function X(a,b,c,d){return xdiff=a-c,ydiff=b-d,Math.sqrt(xdiff*xdiff+ydiff*ydiff)}var a=$("#canvas")[0],b=a.getContext("2d"),c,d,f,g,h=!1,j=25,k,l=180,n=null,o=null,p=null,r=null,s=null,u=null,v=null,x=null,y=null,z=null,A=null,B=null,C=a.width/2,D=a.height/2,E=0,F=1,G=new Array,H={num:10,centerx:a.width/2,centery:a.height/2,snum:10,mid:0,diff:1,zbarc:l,initz:l,zoomin:[1,.5,.25,.2,.1,.05],zoomout:[1,2,5,10,50,100],zoominf:[1,2,4,5,10,20],iewid:Math.floor((a.width-2*j)/100),ewid:Math.floor((a.width-2*j)/100),lower:40,upper:320,ldiv:20,fdiff:1,movemid:function(){var a=c-f,b=d-g;f=c,g=d,this.centerx+=a,this.centery+=b},zoom:function(a){this.ewid=Math.max(this.iewid*(a/this.ldiv),2.5),E=this.ewid*this.snum},moveZBar:function(){var a=d-g;g=d,a+this.zbarc<=this.upper-this.ldiv-1&&a+this.zbarc>=this.lower+this.ldiv+1&&(this.zbarc+=a,l=this.zbarc,this.zbarc<this.initz?(this.diff=this.zoomout[Math.floor((this.initz-this.zbarc)/this.ldiv)],F=this.diff,this.zoom(this.ldiv-(this.initz-this.zbarc)+Math.floor((this.initz-this.zbarc)/this.ldiv)*this.ldiv)):(this.diff=this.zoomin[Math.floor((this.zbarc-this.initz)/this.ldiv)],F=this.diff,this.fdiff=this.zoominf[Math.floor((this.zbarc-this.initz)/this.ldiv)],this.zoom(this.zbarc-this.initz-Math.floor((this.zbarc-this.initz)/this.ldiv)*this.ldiv)))},curpos:function(){m=this.ewid*this.snum,K("x="+Math.round(this.diff*(c-this.centerx)/m*100)/100+", y="+Math.round(this.diff*(this.centery-d)/m*100)/100)},drawZBar:function(){b.strokeStyle="black",P(5,this.lower,5,this.upper),P(5,this.upper,15,this.upper),P(15,this.upper,15,this.lower),P(15,this.lower,5,this.lower),P(5,this.zbarc-this.ldiv,5,this.zbarc+this.ldiv),P(5,this.zbarc+this.ldiv,15,this.zbarc+this.ldiv),P(15,this.zbarc+this.ldiv,15,this.zbarc-this.ldiv),P(15,this.zbarc-this.ldiv,5,this.zbarc-this.ldiv)},draw:function(c){b.strokeStyle="b9b9b9";var d=a.width-j,e=j;t=this.mid;var f=this.mid,g=0;for(i=this.centerx;i>=j;i-=this.ewid*this.snum){if(i<=a.width-j){g==0&&(o=t),g+=1,P(i,j,i,a.height-j);if(i!=this.centerx)if(c=="dec"||this.diff>=1)b.font="9pt Calibri",b.fillStyle="black",(Math.round(t*1e3)/1e3).toString().length<2?b.fillText(Math.round(t*1e3)/1e3,i-5,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<3?b.fillText(Math.round(t*1e3)/1e3,i-10,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<4?b.fillText(Math.round(t*1e3)/1e3,i-15,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<5?b.fillText(Math.round(t*1e3)/1e3,i-20,this.centery+10):b.fillText(Math.round(t*1e3)/1e3,i-25,this.centery+10);else{var h=-f,k=this.fdiff,l=M(h,k);h=Math.round(h/l),k=Math.round(k/l),b.font="9pt Calibri",b.fillStyle="black",k!=1?(b.fillText(-h,i-9,this.centery+5),b.fillText("__",i-9,this.centery+5),b.fillText(k,i-9,this.centery+10)):b.fillText(-h,i-9,this.centery+5)}}n=t,t-=this.diff,f-=1}b.fillText(0,this.centerx-5,this.centery+10),f=this.mid,t=this.mid,g=0;for(i=this.centerx;i<=a.width-j;i+=this.ewid*this.snum)if(i>=j){g==0&&(p=t),g+=1,P(i,j,i,a.height-j);if(i!=this.centerx)if(c=="dec"||this.diff>=1)b.font="9pt Calibri",b.fillStyle="black",(Math.round(t*1e3)/1e3).toString().length<2?b.fillText(Math.round(t*1e3)/1e3,i-5,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<3?b.fillText(Math.round(t*1e3)/1e3,i-10,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<4?b.fillText(Math.round(t*1e3)/1e3,i-15,this.centery+10):(Math.round(t*1e3)/1e3).toString().length<5?b.fillText(Math.round(t*1e3)/1e3,i-20,this.centery+10):b.fillText(Math.round(t*1e3)/1e3,i-25,this.centery+10);else{var h=f,k=this.fdiff,l=M(h,k);h=Math.round(h/l),k=Math.round(k/l),b.font="9pt Calibri",b.fillStyle="black",k!=1?(b.fillText(h,i-9,this.centery+5),b.fillText("__",i-9,this.centery+5),b.fillText(k,i-9,this.centery+5)):b.fillText(-h,i-9,this.centery+5)}r=t,t+=this.diff,f+=1}t=this.mid;var f=0;g=0;for(i=this.centery;i>=j;i-=this.ewid*this.snum){if(i<=a.width-j){g==0&&(v=t),g+=1,P(j,i,a.width-j,i);if(i!=this.centery)if(c=="dec"||this.diff>=1)b.font="9pt Calibri",b.fillStyle="black",(Math.round(t*1e3)/1e3).toString().length<2?b.fillText(Math.round(t*1e3)/1e3,this.centerx-5,i+10):(Math.round(t*1e3)/1e3).toString().length<3?b.fillText(Math.round(t*1e3)/1e3,this.centerx-10,i+10):(Math.round(t*1e3)/1e3).toString().length<4?b.fillText(Math.round(t*1e3)/1e3,this.centerx-15,i+10):(Math.round(t*1e3)/1e3).toString().length<5?b.fillText(Math.round(t*1e3)/1e3,this.centerx-20,i+10):b.fillText(Math.round(t*1e3)/1e3,this.centerx-25,i+10);else{var h=-f,k=this.fdiff,l=M(h,k);h=Math.round(h/l),k=Math.round(k/l),b.font="9pt Calibri",b.fillStyle="black",k!=1?(b.fillText(-h,this.centerx-10,i-3),b.fillText("__",this.centerx-10,i-3),b.fillText(k,this.centerx-10,i+2)):b.fillText(-h,this.centerx-10,i)}}x=t,t+=this.diff,f+=1}f=0,t=this.mid,g=0;for(i=this.centery;i<=a.width-j;i+=this.ewid*this.snum)if(i>=j){g==0&&(u=t),g+=1,P(j,i,a.width-j,i);if(i!=this.centerx)if(c=="dec"||this.diff>=1)b.font="9pt Calibri",b.fillStyle="black",(Math.round(t*1e3)/1e3).toString().length<2?b.fillText(Math.round(t*1e3)/1e3,this.centerx-5,i+10):(Math.round(t*1e3)/1e3).toString().length<3?b.fillText(Math.round(t*1e3)/1e3,this.centerx-10,i+10):(Math.round(t*1e3)/1e3).toString().length<4?b.fillText(Math.round(t*1e3)/1e3,this.centerx-15,i+10):(Math.round(t*1e3)/1e3).toString().length<5?b.fillText(Math.round(t*1e3)/1e3,this.centerx-20,i+10):b.fillText(Math.round(t*1e3)/1e3,this.centerx-25,i+10);else{var h=f,k=this.fdiff,l=M(h,k);h=Math.round(h/l),k=Math.round(k/l),b.font="9pt Calibri",b.fillStyle="black",k!=1?(b.fillText(h,this.centerx-10,i-3),b.fillText("__",this.centerx-10,i-3),b.fillText(k,this.centerx-10,i+2)):b.fillText(-h,this.centerx-10,i)}s=t,t-=this.diff,f-=1}n!=null?A=n:A=p,r!=null?y=r:y=o,s!=null?B=s:B=v,x!=null?z=x:z=u,C=this.centerx,D=this.centery,E=this.ewid*this.snum}};H.draw("dec"),H.drawZBar(),$("#canvas").mousedown(function(a){f=c,g=d,h=!0}),$("#undo").click(function(){G.pop(),J()}),$("#function").click(function(){var a=I();b.strokeStyle=a,G.push(new S($("#circlesize").attr("value"),a)),b.strokeStyle="black"}),$("#canvas").mouseup(function(a){h=!1}),$("#canvas").scroll(function(a){}),$("#canvas").mousemove(function(e){var i=$("#canvas").offset(),k=Math.round(i.left),m=Math.round(i.top);c=e.pageX-k,d=e.pageY-m;if(h){f>j&&(H.movemid(),b.clearRect(0,0,a.width,a.height),H.draw("dec"),H.drawZBar()),f>5&&f<20&&g>l-25&&g<l+25&&(H.moveZBar(),b.clearRect(0,0,a.width,a.height),H.drawZBar(),H.draw("dec"));for(w=0;w<G.length;w++)b.strokeStyle=G[w].color,G[w].draw(),b.strokeStyle="black"}H.curpos()}),sop=new Object,sop.sin="s",sop.cos="c",sop.tan="t",sop.pi="p",sop.cosec="o",sop.sec="d",sop.cot="u",sop.log="l",fns=["s","c","t","o","d","u","l"],opers=new Object,opers["^"]=1,opers["/"]=2,opers["*"]=2,opers["+"]=3,opers["-"]=3,ops=["sin","cosec","cos","sec","tan","cot","pi","log"]})