<%= "Hey"%>
<% @arr = [['%correct','Number of Students']]%>
<% @temp = []%>
<% i=51 %>
<% @classroom.students.each do |student| %>
	<% @b = student.answers.select{|v| v.correct == true } %>
	<% @b_wrong = student.answers.select{|v| v.correct == false } %>
	<% @count = @b.count%>
	<% @count_wrong = @b_wrong.count %>
	<% if @count_wrong+@count == 0%>
		<% @temp.push(-1) %>
	<% else %>
		<% @temp.push((@count*100)/(@count_wrong+@count)) %>
	<% end %>		
<% end %>	
<% @count1 = (@temp.select{|v| v>90}).count %>
	<% @arr.push([">90%", @count1])%>
<% @count2 = ((@temp.select{|v| v>70}).select{|v| v<90}).count %>	
	<% @arr.push([">70%", @count2])%>
<% @count3 = ((@temp.select{|v| v>50}).select{|v| v<70}).count %>	
	<% @arr.push([">50%", @count3])%>
<% @count4 = ((@temp.select{|v| v>30}).select{|v| v<50}).count %>	
	<% @arr.push([">30%", @count4])%>
<% @count5 = ((@temp.select{|v| v>0}).select{|v| v<30}).count %>	
	<% @arr.push([">0%", @count5])%>
<% @count6 = (@temp.select{|v| v<0}).count %>	
	<% @arr.push(["Haven't Attempted", @count6])%>


    <script type="text/javascript">
      google.load("visualization", "1", {packages:["corechart"]});
      google.setOnLoadCallback(drawChart);
      drawChart();
            function drawChart() {

        var data = google.visualization.arrayToDataTable(<%= raw @arr %>);

        var options = {
          title: 'Percentage of correct answers by Students'
        };

        var chart = new google.visualization.PieChart(document.getElementById('chart_div_1_class'));
        chart.draw(data, options);
      }
    </script>
    <div id="chart_div_1_class" style="width: 900px; height: 500px;"></div>


<% @arr = [['%correct','Number of Students']]%>
<% @temp = []%>
<% i=51 %>
<% @classroom.students.each do |student| %>
	<% pset = student.problem_set_instances.where(:problem_set_id => @problem_set.id).last %>
	<% @b = pset.answers.select{|v| v.correct == true } %>
	<% @b_wrong = pset.answers.select{|v| v.correct == false } %>
	<% @count = @b.count%>
	<% @count_wrong = @b_wrong.count %>
	<% if @count_wrong+@count == 0%>
		<% @temp.push(-1) %>
	<% else %>
		<% @temp.push((@count*100)/(@count_wrong+@count)) %>
	<% end %>		
<% end %>	
<% @count1 = (@temp.select{|v| v>90}).count %>
	<% @arr.push([">90%", @count1])%>
<% @count2 = ((@temp.select{|v| v>70}).select{|v| v<90}).count %>	
	<% @arr.push([">70%", @count2])%>
<% @count3 = ((@temp.select{|v| v>50}).select{|v| v<70}).count %>	
	<% @arr.push([">50%", @count3])%>
<% @count4 = ((@temp.select{|v| v>30}).select{|v| v<50}).count %>	
	<% @arr.push([">30%", @count4])%>
<% @count5 = ((@temp.select{|v| v>0}).select{|v| v<30}).count %>	
	<% @arr.push([">0%", @count5])%>
<% @count6 = (@temp.select{|v| v<0}).count %>	
	<% @arr.push(["Haven't Attempted", @count6])%>


    <script type="text/javascript">
      google.load("visualization", "1", {packages:["corechart"]});
      google.setOnLoadCallback(drawChart);
      drawChart();
            function drawChart() {

        var data = google.visualization.arrayToDataTable(<%= raw @arr %>);

        var options = {
          title: 'Percentage of correct answers by Students'
        };

        var chart = new google.visualization.PieChart(document.getElementById('chart_div_2_class_pset'));
        chart.draw(data, options);
      }
    </script>
    <div id="chart_div_2_class_pset" style="width: 900px; height: 500px;"></div>


<% @tempcount_right = 0%>
<% @tempcount_wrong = 0%>
<% @arr7 = [['Problem Types','Correct Percentage']]%>
<% @temp = [] %>
<% @classroom.students.each do |student| %>
	<% pset = student.problem_set_instances.where(:problem_set_id => @problem_set.id).last %>
	<% pset.problem_types.each do |ptype|%>
  		<% @ans_right = ptype.answers.where(:user_id => student.id).select{|v| v.correct == true }%>
  		<% @ans_wrong = ptype.answers.where(:user_id => student.id).select{|v| v.correct == false }%>
  		<% if (@ans_wrong.count + @ans_right.count) > 0 %>  
    		<% @temp.push([ptype.name,@ans_right.count,@ans_wrong.count]) %>
  		<% end %>  
	<% end %>
<% end %>
	

	<% pset = @classroom.problem_sets.find_by_id(@problem_set.id) %>
	<% pset.problem_types.each do |ptype|%>
		<% tempcount_right = 0%>
		<% tempcount_wrong = 0%>
		<% @b = @temp.select{|v| v[0] == ptype.name} %>
		<% @b.each do |b| %>
			<% tempcount_right = tempcount_right + b[1] %>
			<% tempcount_wrong = tempcount_wrong + b[2] %>
		<% end%>
		<% if (tempcount_right + tempcount_wrong) > 0 %>
			<% @arr7.push([ptype.name, (tempcount_right*100)/(tempcount_right+tempcount_wrong)]) %>
		<% end %>
  	<% end %>  



    <script type="text/javascript">
      google.load("visualization", "1", {packages:["corechart"]});
      google.setOnLoadCallback(drawChart);
      drawChart();
      function drawChart() {
        var data7 = google.visualization.arrayToDataTable(<%= raw @arr7 %>);

        var options7 = {
          title: 'Student Performance',
          vAxis: {title: 'Problem Types',  titleTextStyle: {color: 'red'}}
        };

        var chart7 = new google.visualization.BarChart(document.getElementById('chart_div_3_class_pset'));
        chart7.draw(data7, options7);
      }
    </script>
       
    <div id="chart_div_3_class_pset" style="width: 900px; height: 500px;"></div>
